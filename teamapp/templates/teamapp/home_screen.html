{% load static %}
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>ホーム</title>
    <script type="text/javascript" src="{% static 'teamapp/js/sistem.js' %}" ></script>
    <style type="text/css"></style>
    <link rel="stylesheet" href="{% static 'teamapp/home_screen.css' %}">
  </head>
  <body>
    <h1>Django Sample Application</h1>
    <p>You can submit articles from the following form.</p>
    <form action="{% url 'index' %}" method="post">
      {% csrf_token %}
      <div>
        <label for="titleInput">Title</label><br>
        <input id="titleInput" name="title" type="text" placeholder="Input title">
      </div>
      <div>
        <label for="textInput">Text</label><br>
        <textarea id="textInput" name="text" rows="3"></textarea>
      </div>
      <div>
        <button type="submit">Submit</button>
      </div>
      
    </form>

    <a href="{% url 'title' %}?next={{ 'index' }}">ログイン</a>

    <br>
    <div>
      <a href="{% url 'index' %}?sort=data">最新</a>
      <a href="{% url 'index' %}?sort=like">いいね順</a>
    </div>

    {% if articles %}
      {% for article in articles %}
      <div class="text">
        <h2><a href="{% url 'detail' article.id %}">{{article.title}}</a><h2>
        <small>[{{ article.posted_at }}]</small>
        <div>
          <a href="#" class="like-button" data-article-id="{{ article.id }}"> 
            <span class="like-icon" style="{% if request.user.id in article.likes.values_list('user_id', flat=True) %}
            color: red;
            {% else %}
            color: black;
            {% endif %}">
              ♡
            </span>
            </a>
        </div>
        <div>
          {{article.body|linebreaksbr}}
        </div>
      </div>
      {% endfor %}    
    {% else %}
    <p>No article.</p>
    {% endif %} 
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function(event){
        $('.like-button').click(function(event){
          event.preventDefault();

          var articleId = $(this).data(article_id);
          var button = $(this);

          $ajax({
            url: '/article/' + articleId + '/toggle_like/',
            method: 'POST',
            success: function(response){
              if(response.liked){
                button.find('.like-icon').css('color', 'red');
              }else{
                button.find('.like-icon').css('color', 'black');
              }
              $('#like_count-' + articleId).text(response.likes_count);
            },
            error: function(xhr, status, error){
              console.log('Error' + error)
            }
          });
        });
      });
    </script>

    <div style="text-align: center;">
      <img src="{% static 'teamapp/images/img_20241213_161452.jpg' %}" alt="Uploaded Image" width: 500px; height= 500px;>
    </div>
    
        
    <div class="app">
      <div class="header">ヘッダー</div>
      <div class="main">
        <div class="sidebar">サイドバー   <a href="{% url 'bio' %}">プロフィール</a>
          <br><a href="{% url 'detailscreen' %}">投稿画面</a>
          <br><a href="{% url 'title' %}">リログイン/アカウント作成</a>
        
        </div>
        <div class="content">
          <div class="flex-content">コンテンツ1</div>
          <div class="fixed-content">コンテンツ2</div>
        </div>
      </div>
    </div>
  </body>
</html>